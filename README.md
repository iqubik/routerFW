Много кто здесь мечтал иметь персональный бинарник роутера с полным конфигом и кастомными пакетами? Не просто резервная копия, а прямо откат версию в bin?
Я себе соорудил конвейер по сборке прошивок через билдер в докер контейнерах с помощью docker desktop win11 и собирает оно мило и бодро пока по 4 профилям, 19 версию на спец докер образе в старом окружении а 24 современную в свежем с кэшированием и временем повторной сборки в 30 секунд и первичной до 2 минут ну и на первый старт окружения надо ещё минут 5.

И в итоге апнул версию для массового использования. Не пугайтесь base64 вставок их можно расшифровать онлайн и убедится, что всё как надо.

Интерфейс:
 # 
========================================
OpenWrt Smart Builder v4.0 (iqubik)
========================================

Обнаруженные профили:

[1] example_841n.conf
[2] giga.conf

[A] Собрать ВСЕ профили (Параллельно)
[0] Выход

Выберите опцию:


Описание:
Автономная система сборки прошивок в одном bat файле. Собирает в двух разных окружениях старые и новые прошивки с помощью docker desktop. Тестировалась и разрабатывалась на win11.
Умеет собирать прошивки по данным профиля, сама находит профили в папке профилей. В комплекте 2 тестовых профиля сборки.

custom_packages - папка для кастомных ipk. Просто кидаем их сюда а в профиле указываем верное имя пакета и они запекутся в прошивку.
custom_files/название_профиля - корень вашей прошивки, если сюда распаковать родной backup с openwrt то получится, что прошивка выйдет заранее настроенной.
firmware_output/название_профиля - тут будут лежать ваши прошивки с timestamp времени сборки в имени файла.
profiles - папка профилей сборки.
Все папки, подпапки и файлы bat файл создаст сам при первом запуске.

Пример профиля:
PROFILE_NAME="example_841n"
TARGET_PROFILE="tl-wr841-v9"
IMAGEBUILDER_URL="https://downloads.openwrt.org/releases/19.07.9/targets/ar71xx/tiny/openwrt-imagebuilder-19.07.9-ar71xx-tiny.Linux-x86_64.tar.xz"
PKGS="luci-base"


Приятного использования.

P.S. Я прям хотел штуку которая умеет запекать конфиги и ipk сразу в прошивку, чтобы и обновляться было легко и резерв иметь грамотный.
UPD. Добавлен Power Shell скрипт create_profile.ps1 который помогает сформировать нужный профиль для сборки через парсинг оффсайта

===

По поводу полных версий пакетов. Как я понял методика такая:
В готовой прошивке 7z в /usr/lib/opkg есть файл status - там все пакеты и зависимости к ним. Под некоторыми написано autoinstalled yes - значит какой то другой пакет затребовал установку именно этого.
Идея в том чтобы найти виновника и поставить только нужные его части, а в списке пакетов указать -dnsmasq добавив минус вначале пакета а потом dnsmasq-full

===
Возможно ли в этом инструменте сборки изменять размер свободного места? К примеру сейчас доступного места 100мб можно например изменить его в собранном образе на 200мб.
Да. Начиная с версии 4 инструмента можно в профиль добавлять ROOTFS_SIZE=""
