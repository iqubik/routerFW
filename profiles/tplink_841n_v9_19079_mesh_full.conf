# === Profile for TL-WR841N v9 mesh (Legacy 19.07.9) ===

PROFILE_NAME="841n-v9-190709-full-mesh"
TARGET_PROFILE="tl-wr841-v9"

COMMON_LIST="base-files nano busybox dropbear fstools kernel kmod-ath9k kmod-gpio-button-hotplug logd \
mtd netifd swconfig uci urandom-seed urngd iw-full libiwinfo-lua wpad-basic batctl kmod-batman-adv \
-wpad-mini -ip6tables -kmod-ppp -kmod-pppoe -kmod-pppox -luci-proto-ppp -ppp -ppp-mod-pppoe -iw -firewall \
-iw -opkg -odhcp6c -odhcpd-ipv6only -libip6tc -iptables -kmod-ipt-core -kmod-nf-conntrack -libxtables12 \
-libiwinfo-lua -liblua5.1.5 -uclient-fetch -libuclient -uboot-envtools"

# === IMAGE BUILDER CONFIG
IMAGEBUILDER_URL="https://downloads.openwrt.org/releases/19.07.9/targets/ar71xx/tiny/openwrt-imagebuilder-19.07.9-ar71xx-tiny.Linux-x86_64.tar.xz"
PKGS="$COMMON_LIST"
#EXTRA_IMAGE_NAME="v2-stable"
#DISABLED_SERVICES="transmission-daemon minidlna"
#CUSTOM_KEYS="https://fantastic-packages.github.io/releases/24.10/53ff2b6672243d28.pub"
#CUSTOM_REPOS="src/gz fantastic_luci https://fantastic-packages.github.io/releases/24.10/packages/aarch64_generic/luci
#src/gz fantastic_packages https://fantastic-packages.github.io/releases/24.10/packages/aarch64_generic/packages
#src/gz fantastic_special https://fantastic-packages.github.io/releases/24.10/packages/aarch64_generic/special"

# === SOURCE BUILDER CONFIG
SRC_REPO="https://github.com/openwrt/openwrt.git"
SRC_BRANCH="v19.07.9"
SRC_TARGET="ar71xx"
SRC_SUBTARGET="tiny"
SRC_PACKAGES="$PKGS"
# safe = max-1; иди задать число ядер вручную =5
SRC_CORES="safe"

# === Extra config options
#ROOTFS_SIZE="512"
#KERNEL_SIZE="64"

##ЭКОНОМИЯ МЕСТА (Для 4MB / 8MB флешек)
#    - CONFIG_LUCI_SRCDIET=y      -> Сжимает Lua/JS в LuCI (экономит ~100-200KB)
#    - CONFIG_IPV6=n              -> Полностью вырезает IPv6 (экономит ~300KB)
#    - CONFIG_KERNEL_DEBUG_INFO=n -> Удаляет отладочную инфо из ядра
#    - CONFIG_STRIP_KERNEL_EXPORTS=y -> Удаляет таблицу экспортов (если не нужны kmod)
##ФАЙЛОВЫЕ СИСТЕМЫ (Для SD-карт / x86 / NanoPi)
#    По умолчанию создается SquashFS (только чтение). Для одноплатников лучше EXT4.
#    - CONFIG_TARGET_ROOTFS_SQUASHFS=n -> Отключить SquashFS
#    - CONFIG_TARGET_ROOTFS_EXT4FS=y   -> Включить EXT4 (RW раздел)
#    - CONFIG_TARGET_ROOTFS_TARGZ=y    -> Создать архив (для контейнеров/бэкапа)
# CONFIG_TARGET_ROOTFS_SQUASHFS=n CONFIG_TARGET_ROOTFS_EXT4FS=y
##ОТЛАДКА И ЛОГИ
#    - CONFIG_KERNEL_PRINTK=n     -> Отключает вывод лога загрузки на экран (тихий бут)
#    - CONFIG_BUILD_LOG=y         -> Сохраняет логи сборки каждого пакета (для отладки ошибок)
# CONFIG_BUILD_LOG=y
##ПРИНУДИТЕЛЬНОЕ ВКЛЮЧЕНИЕ МОДУЛЕЙ
#    Если пакет не ставится через SRC_PACKAGES, можно включить его тут.
# CONFIG_PACKAGE_kmod-usb-net-rndis=y

SRC_ARCH="mips_24kc"

SRC_EXTRA_CONFIG='CONFIG_TARGET_ar71xx=y
CONFIG_TARGET_ar71xx_tiny=y
CONFIG_TARGET_ar71xx_tiny_DEVICE_tl-wr841-v9=y
CONFIG_BATMAN_ADV_BATMAN_V=y
CONFIG_BATMAN_ADV_BLA=y
CONFIG_BATMAN_ADV_DAT=y
CONFIG_BATMAN_ADV_MCAST=y
CONFIG_BATMAN_ADV_SYSFS=y
CONFIG_PACKAGE_batctl-default=y
# CONFIG_PACKAGE_firewall is not set
# CONFIG_PACKAGE_ip6tables is not set
# CONFIG_PACKAGE_iptables is not set
# CONFIG_PACKAGE_iw is not set
CONFIG_PACKAGE_iw-full=y
CONFIG_PACKAGE_kmod-batman-adv=y
CONFIG_PACKAGE_kmod-crypto-crc32c=y
CONFIG_PACKAGE_kmod-crypto-hash=y
# CONFIG_PACKAGE_kmod-ip6tables is not set
# CONFIG_PACKAGE_kmod-ipt-conntrack is not set
# CONFIG_PACKAGE_kmod-ipt-nat is not set
# CONFIG_PACKAGE_kmod-lib-crc-ccitt is not set
CONFIG_PACKAGE_kmod-lib-crc16=y
CONFIG_PACKAGE_kmod-lib-crc32c=y
# CONFIG_PACKAGE_kmod-nf-conntrack6 is not set
# CONFIG_PACKAGE_kmod-nf-ipt6 is not set
# CONFIG_PACKAGE_kmod-nf-nat is not set
# CONFIG_PACKAGE_kmod-nf-reject6 is not set
# CONFIG_PACKAGE_kmod-ppp is not set
# CONFIG_PACKAGE_libip4tc is not set
# CONFIG_PACKAGE_libip6tc is not set
CONFIG_PACKAGE_libncurses=y
CONFIG_PACKAGE_librt=y
# CONFIG_PACKAGE_libuclient is not set
# CONFIG_PACKAGE_libxtables is not set
CONFIG_PACKAGE_nano=y
# CONFIG_PACKAGE_odhcp6c is not set
# CONFIG_PACKAGE_odhcpd-ipv6only is not set
# CONFIG_PACKAGE_opkg is not set
# CONFIG_PACKAGE_ppp is not set
CONFIG_PACKAGE_terminfo=y
# CONFIG_PACKAGE_uboot-envtools is not set
# CONFIG_PACKAGE_uclient-fetch is not set
CONFIG_PACKAGE_wpad-basic=y
# CONFIG_PACKAGE_wpad-mini is not set'
