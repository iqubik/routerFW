# === Profile for cmcc_rax3000m (OpenWrt 24.10.5) ===

PROFILE_NAME="rax3000m_emmc_test"
TARGET_PROFILE="cmcc_rax3000m-emmc"

COMMON_LIST="kmod-usb-storage terminfo luci-proto-wireguard kmod-ipt-proto kmod-ipt-nfqueue libopenssl3 openssh-sftp-server kmod-ip6tables-extra kmod-lib-textsearch kmod-macvlan kmod-ebtables luci-app-travelmate mkf2fs opkg libevdev iptables-mod-extra libpthread iw libpci kmod-usb-net-qmi-wwan kmod-hwmon-pwmfan ip-full jq libopenssl-afalg_sync zram-swap libubus-lua kmod-ipt-tproxy nano-full kmod-tun bash kmod-inet-diag kmod-crypto-md4 openssl-util kmod-usb-serial-sierrawireless kmod-nf-flow kmod-lib-crc-ccitt kmod-ipt-filter getrandom libiptext0 kmod-ipt-nat-extra iptables-mod-iface kmod-phy-aquantia kmod-asn1-decoder libustream-openssl20201210 libusb-1.0-0 kmod-nf-nathelper kmod-pppoe kmod-usb-net-huawei-cdc-ncm libcap libcap-ng kmod-pppox luci-app-modemband luci-app-sms-tool-js kmod-ipt-conntrack procd-ujail base-files kmod-nf-nat kmod-fs-msdos kmod-crypto-crc32c luci-app-ttyd luci-proto-quectel luci-app-diskman kmod-crypto-blake2b fitblk libf2fs6 libnl-route200 libsmartcols1 uboot-envtools kmod-usb-ohci libmount1 usbutils luci-app-zerotier kmod-nf-dup-inet libbpf1 iptables-mod-nat-extra libkmod libnl200 libnetfilter-conntrack3 ruby-pstore iptables-mod-ipmark kmod-crypto-acompress kmod-usb-serial-qualcomm libelf1 kmod-usb-ehci libxtables12 ruby-digest kmod-ipt-raw6 luci-i18n-base-ru lsblk kmod-usb-net-cdc-mbim kmod-usb-net-rndis luci-proto-modemmanager usbids block-mount iptables-mod-tee kmod-usb2 iptables-mod-iprange kmod-usb-serial-option kmod-usb3 kmod-fs-exfat kmod-ipt-compat-xtables comgt libopenssl-legacy luci-i18n-ttyd-ru ruby ruby-yaml kmod-ipt-conntrack-extra luci-app-3ginfo-lite luci-lib-ipkg kmod-usb-net-sierrawireless wpad-openssl tcpdump luci-i18n-sms-tool-js-ru luci-i18n-dashboard-ru odhcp6c uclient-fetch kmod-ipt-extra unzip iptables-mod-ipopt ethtool uci lua kmod-fs-ext4 kmod-ebtables-ipv4 kmod-ebtables-ipv6 dropbear libpcre2 kmod-mtd-rw kmod-hwmon-core kmod-cryptodev kmod-usb-serial-wwan libgmp10 mtd odhcpd-ipv6only kmod-ipt-tee luci-i18n-travelmate-ru kmod-ipt-hashlimit kmod-crypto-hw-safexcel luci-proto-qmi kmod-crypto-ccm kmod-fs-btrfs urandom-seed ipset libopenssl-devcrypto kmod-ipt-iface luci-mod-dashboard blockd libcomerr0 ppp libnettle8 kmod-leds-gpio kmod-gpio-button-hotplug ruby-enc logd libreadline8 ip-bridge librt kmod-wireguard iptables-mod-tproxy wifi-scripts wireguard-tools ruby-date kmod-usb-serial openssh-keygen iptables-mod-hashlimit libipset13 iptables-mod-proto libnl-cli200 kmod-fs-ntfs3 libruby3.3 kmod-crypto-ecb iptables-mod-filter libnl-core200 kmod-nf-conntrack-netlink kmod-libphy kmod-crypto-des libext2fs2 libiptext6-0 kmod-nf-nathelper-extra e2fsprogs kmod-usb-acm kmod-ata-core kmod-usb-net-ipheth ca-certificates kmod-ppp libfido2-1 libopenssl-conf kmod-fs-f2fs libncurses6 kmod-ipt-ipset ip-tiny libpcap1 libss2 luci-i18n-package-manager-ru kmod-usb-net-qmi-wwan-quectel ruby-psych uqmi iptables-mod-ipv4options luci-proto-mbim iptables-mod-conntrack-extra iptables-mod-u32 kmod-crypto-xxhash htop kmod-crypto-gcm sms-tool f2fsck kmod-usb-net-qmi-wwan-fibocom kmod-tcp-bbr kmod-nls-cp932 kmod-fs-autofs4 comgt-ncm kmod-nls-cp936 rpcd-mod-rpcsys ca-bundle kmod-zram libuclient20201210 kmod-ipt-ipmark umbim kmod-crypto-cmac kmod-ipt-ipopt luci-app-argon-config bc qmi-utils luci-app-filebrowser-go ruby-bigdecimal kmod-nf-conntrack6 kmod-wwan libstdcpp6 kmod-nls-cp950 mbim-utils ip6tables-extra kmod-ipt-ipv4options kmod-crypto-crc32 blkid kmod-ipt-u32 kmod-crypto-chacha20poly1305 libatomic1 kmod-usb-storage-extras kmod-ifb kmod-mppe luci-i18n-3ginfo-lite-ru libnl-nf200 hostapd-common libcbor0 kmod-ipt-offload kmod-nf-conncount libe2p2 kmod-crypto-arc4 kmod-usb-net-cdc-ether wireless-regdb urngd kmod-slhc ppp-mod-pppoe kmod-nf-tproxy kmod-ipt-nat kmod-sched-core libnl-genl200 kmod-ipt-iprange luci-proto-ncm \
luci-proto-amneziawg luci-i18n-amneziawg-ru mtkhqos_util datconf rdisc6 luci-app-turboacc-mtk libkvcutil amneziawg-tools kmod-Airpi-gpio-fan luci-app-mtwifi-cfg autocore-arm luci-i18n-modemband-ru atinout kmod-mediatek_hnat kmod-conninfra regs luci-app-ssclash kmod-mt_wifi ndisc6 luci-app-wrtbwmon datconf-lua kmod-amneziawg luci-i18n-argon-config-ru default-settings mtk-smp quectel-CM-5G switch kvcedit luci-proto-xmm mii_mgr fancontrol luci-app-eqos-mtk luci-i18n-firewall-ru dnsmasq-full kmod-nft-tproxy kmod-nft-compat kmod-nft-fib ip6tables-nft kmod-nft-bridge kmod-nft-nat iptables-nft kmod-nft-netdev xtables-nft luci-app-nft-qos kmod-nft-offload libiptext-nft0 kmod-nft-queue kmod-nft-core luci-i18n-nft-qos-ru"

# === IMAGE BUILDER CONFIG
#IMAGEBUILDER_URL="https://downloads.immortalwrt.org/releases/24.10.4/targets/mediatek/filogic/immortalwrt-imagebuilder-24.10.4-mediatek-filogic.Linux-x86_64.tar.zst"
PKGS="$COMMON_LIST -luci-proto-amneziawg -luci-i18n-amneziawg-ru -mtkhqos_util -datconf -rdisc6 -luci-app-turboacc-mtk -libkvcutil -amneziawg-tools -kmod-Airpi-gpio-fan -luci-app-mtwifi-cfg -autocore-arm -luci-i18n-modemband-ru -atinout -kmod-mediatek_hnat -kmod-conninfra -regs -luci-app-ssclash -kmod-mt_wifi -ndisc6 -luci-app-wrtbwmon -datconf-lua -kmod-amneziawg -luci-i18n-argon-config-ru -default-settings -mtk-smp -quectel-CM-5G -switch -kvcedit -luci-proto-xmm -mii_mgr -fancontrol -luci-app-eqos-mtk -luci-i18n-firewall-ru -dnsmasq-full -kmod-nft-tproxy -kmod-nft-compat -kmod-nft-fib -ip6tables-nft -kmod-nft-bridge -kmod-nft-nat -iptables-nft -kmod-nft-netdev -xtables-nft -luci-app-nft-qos -kmod-nft-offload -libiptext-nft0 -kmod-nft-queue -kmod-nft-core -luci-i18n-nft-qos-ru"
#EXTRA_IMAGE_NAME="custom"
#CUSTOM_KEYS="https://fantastic-packages.github.io/releases/24.10/53ff2b6672243d28.pub"
#CUSTOM_REPOS="src/gz fantastic_luci https://fantastic-packages.github.io/releases/24.10/packages/mipsel_24kc/luci
#src/gz fantastic_packages https://fantastic-packages.github.io/releases/24.10/packages/mipsel_24kc/packages
#src/gz fantastic_special https://fantastic-packages.github.io/releases/24.10/packages/mipsel_24kc/special"
#DISABLED_SERVICES="transmission-daemon minidlna"

# === SOURCE BUILDER CONFIG
# Базовые пакеты и утилиты
BASE_PKGS="kmod-usb-storage kmod-usb2 kmod-usb3 kmod-usb-ohci kmod-usb-ehci block-mount blkid lsblk unzip htop nano-full resize2fs tune2fs bash curl wget-ssl uclient-fetch"
# Сеть и VPN
NET_PKGS="luci-proto-wireguard wireguard-tools luci-app-zerotier luci-proto-amneziawg amneziawg-tools luci-app-ssclash"
# Модемы (Оптимизированный набор)
# Убраны конфликтующие kmod-usb-net-qmi-wwan-*, оставлен стандартный + утилиты
MODEM_PKGS="kmod-usb-serial-option kmod-usb-serial-wwan kmod-usb-net-qmi-wwan kmod-usb-net-cdc-mbim kmod-usb-net-rndis kmod-usb-net-huawei-cdc-ncm uqmi umbim luci-proto-qmi luci-proto-mbim luci-proto-modemmanager luci-app-modemband luci-app-sms-tool-js sms-tool picocom comgt-ncm"
# Ускорение (Только NFTABLES + HNAT)
ACCEL_PKGS="luci-app-turboacc-mtk kmod-nft-offload kmod-mediatek_hnat mtkhqos_util"
# Дополнительно
EXTRA_PKGS="luci-app-ttyd luci-app-diskman luci-app-filebrowser-go luci-theme-argon luci-app-wrtbwmon"

# safe = max-1; иди задать число ядер вручную =5
SRC_CORES="safe"

SRC_REPO="https://github.com/padavanonly/immortalwrt-mt798x-6.6.git"
SRC_BRANCH="openwrt-24.10-6.6"
SRC_TARGET="mediatek"
SRC_SUBTARGET="filogic"
SRC_PACKAGES=""
#SRC_PACKAGES="$BASE_PKGS $NET_PKGS $MODEM_PKGS $ACCEL_PKGS $EXTRA_PKGS"

# === Extra config options
#ROOTFS_SIZE="512"
#KERNEL_SIZE="64"
SRC_EXTRA_CONFIG="CONFIG_TARGET_MULTI_PROFILE=y \
CONFIG_BUILD_LOG=y"

##ЭКОНОМИЯ МЕСТА (Для 4MB / 8MB флешек)
#    - CONFIG_LUCI_SRCDIET=y      -> Сжимает Lua/JS в LuCI (экономит ~100-200KB)
#    - CONFIG_IPV6=n              -> Полностью вырезает IPv6 (экономит ~300KB)
#    - CONFIG_KERNEL_DEBUG_INFO=n -> Удаляет отладочную инфо из ядра
#    - CONFIG_STRIP_KERNEL_EXPORTS=y -> Удаляет таблицу экспортов (если не нужны kmod)
##ФАЙЛОВЫЕ СИСТЕМЫ (Для SD-карт / x86 / NanoPi)
#    По умолчанию создается SquashFS (только чтение). Для одноплатников лучше EXT4.
#    - CONFIG_TARGET_ROOTFS_SQUASHFS=n -> Отключить SquashFS
#    - CONFIG_TARGET_ROOTFS_EXT4FS=y   -> Включить EXT4 (RW раздел)
#    - CONFIG_TARGET_ROOTFS_TARGZ=y    -> Создать архив (для контейнеров/бэкапа)
##ОТЛАДКА И ЛОГИ
#    - CONFIG_KERNEL_PRINTK=n     -> Отключает вывод лога загрузки на экран (тихий бут)
#    - CONFIG_BUILD_LOG=y         -> Сохраняет логи сборки каждого пакета (для отладки ошибок)
##ПРИНУДИТЕЛЬНОЕ ВКЛЮЧЕНИЕ МОДУЛЕЙ
#    Если пакет не ставится через SRC_PACKAGES, можно включить его тут.
# CONFIG_PACKAGE_kmod-usb-net-rndis=y
SRC_ARCH="aarch64_cortex-a53"
