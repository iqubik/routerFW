# file docs\06-rax3000m-emmc-flash.md

<p align="center">
  <b>üá∑üá∫ –†—É—Å—Å–∫–∏–π</b> | <a href="06-rax3000m-emmc-flash.en.md"><b>üá∫üá∏ English</b></a>
</p>

---

# –£—Ä–æ–∫ 6: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏ –Ω–∞ RAX3000M eMMC (—Ä—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞)

**–¶–µ–ª—å:** –ü–æ—à–∞–≥–æ–≤–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—à–∏–≤–∫—É (–≤ —Ç.—á. Padavanonly) –Ω–∞ –≤–µ—Ä—Å–∏—é RAX3000M —Å eMMC, –∫–æ–≥–¥–∞ —à—Ç–∞—Ç–Ω—ã–π sysupgrade –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–∑–º–µ—Ç–∫—É GPT, –Ω–∞—Å—Ç—Ä–æ–π–∫—É bootenv –∏ –∑–∞–ø–∏—Å—å —Ä–∞–∑–¥–µ–ª–æ–≤ –ø–æ SSH.

> **–í–ù–ò–ú–ê–ù–ò–ï:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å eMMC (–∫–æ–º–∞–Ω–¥–∞ `dd`) –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã. –û—à–∏–±–∫–∞ –≤ –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É ‚Äî —Ä–∏—Å–∫ –∫–∏—Ä–ø–∏—á–∞. –î–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã –∏ –∏–º–µ–π—Ç–µ –ø–æ–¥ —Ä—É–∫–æ–π UART, –µ—Å–ª–∏ —Ä–µ—à–∞–µ—Ç–µ—Å—å –Ω–∞ —Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É.

---

## –ö–æ–≥–¥–∞ —ç—Ç–æ –Ω—É–∂–Ω–æ

*   –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –µ—â—ë –Ω–µ—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ GPT (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å –≤–∞–Ω–∏–ª—å–Ω–æ–≥–æ OpenWrt –∏–ª–∏ Keenetic), –∏ sysupgrade –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑.
*   –í—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ —Å –¥—Ä—É–≥–æ–π –ø—Ä–æ—à–∏–≤–∫–∏ (OpenWrt / ImmortalWrt / Keenetic) –Ω–∞ —Å–±–æ—Ä–∫—É Padavanonly –∏–ª–∏ –∏–Ω—É—é, —Ç—Ä–µ–±—É—é—â—É—é —Å–≤–æ–µ–π —Ä–∞–∑–º–µ—Ç–∫–∏.

**–ü–µ—Ä–µ—Ö–æ–¥ Keenetic ‚Üí Padavanonly:** —Å–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–∞–Ω–∏–ª—å–Ω—ã–π OpenWrt –ø–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ —à–∞–≥–∏ –Ω–∏–∂–µ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞ eMMC.

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏

*   **eMMC:** –∑–∞–ø–∏—Å—å –∏–¥—ë—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é –ø–∞–º—è—Ç—å. –ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å –∏–ª–∏ —Ä–∞–∑–¥–µ–ª –º–æ–∂–µ—Ç –≤—ã–≤–µ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–∑ —Å—Ç—Ä–æ—è.
*   **`dd`:** –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (`lsblk`), –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏—è `seek`/`count`.
*   **UART:** –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Å–æ–ª–∏ U-Boot –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è bootenv –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è.
*   **–ë—ç–∫–∞–ø—ã:** –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π –æ–±—Ä–∞–∑ eMMC –∏–ª–∏ —Ö–æ—Ç—è –±—ã —Ä–∞–∑–¥–µ–ª `factory` (–∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ Wi‚ÄëFi).

---

## –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã

–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤ `/tmp` –Ω–∞ —Ä–æ—É—Ç–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ WinSCP):

*   **GPT:** —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–¥–µ–ª–æ–≤ ‚Äî –æ–±—ã—á–Ω–∞—è –∏–ª–∏ —Å–æ swap (2 –ì–ë). –§–∞–π–ª—ã –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –Ω–∞ 4pda –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç–æ–π [bl-mt798x-dhcpd](https://github.com/Yuzhii0718/bl-mt798x-dhcpd) (—Ä–∞–∑–¥–µ–ª ¬´–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è¬ª –≤ –∑–∞–∫—Ä–µ–ø–µ). –í –∫–æ–º–∞–Ω–¥–∞—Ö –Ω–∏–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∞—Ä–∏–∞–Ω—Ç —Å–æ swap: —Ñ–∞–π–ª `gpt-rax3000m-emmc-swap.bin`; –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ –±–µ–∑ swap –∏–º—è —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç –¥—Ä—É–≥–∏–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gpt-rax3000m-emmc.bin`), –∑–Ω–∞—á–µ–Ω–∏—è `seek` –≤ dd –Ω–µ –º–µ–Ω—è—é—Ç—Å—è.
*   **–ó–∞–≥—Ä—É–∑—á–∏–∫ (FIP):** `u-boot.fip` ‚Äî –∏–∑ —Å–±–æ—Ä–∫–∏ –∏–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è [bl-mt798x-dhcpd](https://github.com/Yuzhii0718/bl-mt798x-dhcpd).
*   **–Ø–¥—Ä–æ –∏ rootfs:** `kernel.bin` –∏ `rootfs.bin` ‚Äî –∏–∑–≤–ª–µ–∫–∏—Ç–µ –∏–∑ sysupgrade-–æ–±—Ä–∞–∑–∞ –ø—Ä–æ—à–∏–≤–∫–∏ –∞—Ä—Ö–∏–≤–∞—Ç–æ—Ä–æ–º (7z –∏ —Ç.–ø.).

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ eMMC –≤–∏–¥–Ω–∞ –∫–∞–∫ `mmcblk0`:

```bash
lsblk
```

---

## –®–∞–≥ 0: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ bootenv (U-Boot)

–ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö `bootargs` –∏ `bootcmd` —Ä–æ—É—Ç–µ—Ä –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç –Ω–æ–≤—É—é –ø—Ä–æ—à–∏–≤–∫—É.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ç–∏–ª–∏—Ç

```bash
opkg update
opkg install uboot-envtools
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è fw_env

–£–∫–∞–∂–∏—Ç–µ —É—Ç–∏–ª–∏—Ç–µ, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ U-Boot:

```bash
echo "/dev/mmcblk0p1 0x0 0x80000" > /etc/fw_env.config
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
fw_printenv
```

–ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—ã–≤–æ–¥–∏—Ç—Å—è ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –∑–∞–ø–∏—Å–∏.

### –ó–∞–ø–∏—Å—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–∫–∏

```bash
fw_setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p5 rootwait"
fw_setenv bootcmd 'mmc dev 0; gpt setenv mmc 0 kernel; mmc read ${loadaddr} ${gpt_part_addr} ${gpt_part_size}; bootm ${loadaddr}'
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
fw_printenv bootargs
fw_printenv bootcmd
```

–í –≤—ã–≤–æ–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (–≤ —Ç.—á. `${loadaddr}`), –±–µ–∑ –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π.

---

## –®–∞–≥ 1: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö

–ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏—è `seek` –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∞—à–µ–π GPT –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ –∑–∞–∫—Ä–µ–ø–∞. –ù–∏–∂–µ ‚Äî —Ç–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è RAX3000M eMMC.

**–ó–∞–ø–∏—Å—å —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–¥–µ–ª–æ–≤ (GPT):**

```bash
dd if=/tmp/gpt-rax3000m-emmc-swap.bin of=/dev/mmcblk0 bs=512 count=34 conv=notrunc
```

**–ó–∞–ø–∏—Å—å –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ (U-Boot / FIP):**

```bash
dd if=/tmp/u-boot.fip of=/dev/mmcblk0 bs=512 seek=13312 conv=notrunc
```

**–ó–∞–ø–∏—Å—å —è–¥—Ä–∞:**

```bash
dd if=/tmp/kernel.bin of=/dev/mmcblk0 bs=512 seek=21504 conv=notrunc
```

**–ó–∞–ø–∏—Å—å rootfs:**

```bash
dd if=/tmp/rootfs.bin of=/dev/mmcblk0 bs=512 seek=152576 conv=notrunc
```

---

## –®–∞–≥ 2: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è

–°–±—Ä–æ—Å –±—É—Ñ–µ—Ä–æ–≤ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞:

```bash
sync
```

–ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ä–∞–∑–º–µ—Ç–∫—É —Å–æ swap:

```bash
mkswap /dev/mmcblk0p7
```

–ó–∞—Ç–µ–º:

```bash
reboot
```

–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–ª—å—à–µ –æ–±—ã—á–Ω–æ–≥–æ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤). –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π sysupgrade –∏–∑ –ø–æ–ª–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞ –ø—Ä–æ—à–∏–≤–∫–∏ (–≤ –Ω—ë–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π vermagic –∏ –Ω–∞–±–æ—Ä –æ–±—Ä–∞–∑–æ–≤).

---

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (overlay –Ω–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è, —Ä–∞–∑–º–µ—Ä –§–° –Ω–∞ overlay-—Ä–∞–∑–¥–µ–ª–µ (`/dev/mmcblk0p6`) –º–æ–∂–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–æ–≤–æ–π GPT. –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç ¬´–±–∏—Ç—ã–π¬ª —Ä–∞–∑–¥–µ–ª.

**¬´–ú–µ—Ç–æ–¥ —Å–∞–±–æ—Ç–∞–∂–∞¬ª** (–µ—Å–ª–∏ –Ω–µ—Ç Failsafe): –∑–∞—Ç–µ—Ä–µ—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞, —á—Ç–æ–±—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å—á–∏—Ç–∞–ª–∞ —Ä–∞–∑–¥–µ–ª –ø—É—Å—Ç—ã–º –∏ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–ª–∞ –µ–≥–æ —Å–∞–º–∞.

–ü–æ SSH:

```bash
dd if=/dev/zero of=/dev/mmcblk0p6 bs=4096 count=100 conv=notrunc
reboot -f
```

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ overlay –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ GPT —Å–æ swap, –∑–∞–Ω–æ–≤–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ swap:

```bash
mkswap /dev/mmcblk0p7
uci set fstab.@swap[-1]=swap
uci set fstab.@swap[-1].device='/dev/mmcblk0p7'
uci set fstab.@swap[-1].enabled='1'
uci commit fstab
/etc/init.d/fstab boot
```

### –†–æ—É—Ç–µ—Ä –Ω–µ –≥—Ä—É–∑–∏—Ç—Å—è, –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ U-Boot (UART)

–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ ¬´–ø–æ—Ç–µ—Ä—è–Ω–∞¬ª, –∑–∞–¥–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ä—É—á–Ω—É—é –≤ –∫–æ–Ω—Å–æ–ª–∏ U-Boot:

```
setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p5 rootwait"
setenv bootcmd "mmc dev 0; gpt setenv mmc 0 kernel; mmc read ${loadaddr} ${gpt_part_addr} ${gpt_part_size}; bootm ${loadaddr}"
saveenv
reset
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–í—ã—Ä–µ–∑–∞—Ç—å —Ä–∞–∑–¥–µ–ª `factory` (–∫–∞–ª–∏–±—Ä–æ–≤–∫–∏) –∏–∑ –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞:**

```bash
zcat full_backup.img.gz | dd of=factory.bin bs=512 skip=$((0x2400)) count=$((0x1000)) status=progress
```

**–°—Ä–∞–≤–Ω–∏—Ç—å —Ö–µ—à —Ñ–∞–π–ª–∞ –∏ —Ä–∞–∑–¥–µ–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, factory):**

```bash
sha256sum /tmp/factory.bin
dd if=/dev/mmcblk0p2 bs=2M count=1 | sha256sum
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

*   **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä GPT:** [bl-mt798x-dhcpd](https://github.com/Yuzhii0718/bl-mt798x-dhcpd) ‚Äî –¥–ª—è —Å–≤–æ–µ–π —Ä–∞–∑–º–µ—Ç–∫–∏ (–≤ —Ç.—á. —Å–æ swap).
*   **–ì–æ—Ç–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã –∏ —Å–±–æ—Ä–∫–∏:** —Å–º. –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –Ω–∞ 4pda –∏ [Releases](https://github.com/iqubik/routerFW/releases). –î–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [RouterFW Builder](https://github.com/iqubik/routerFW) –∏ [–£—Ä–æ–∫ 3](03-source-build.md).

–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ [–æ–≥–ª–∞–≤–ª–µ–Ω–∏—é —É—Ä–æ–∫–æ–≤](index.md).
