# file: system/docker-compose.yaml V1.8
services:
  builder-openwrt:
    build:
      context: ..
      dockerfile: system/dockerfile
    environment:
      - CONF_FILE=${SELECTED_CONF}
      - HOST_OUTPUT_DIR=${HOST_OUTPUT_DIR}
    volumes:
      - imagebuilder-cache:/cache
      - ipk-cache:/builder_workspace/dl
      - ../${HOST_PKGS_DIR}:/input_packages
      - ../${HOST_FILES_DIR}:/overlay_files
      - ../firmware_output:/output
      - ../profiles:/profiles
      - ./openssl.cnf:/openssl.cnf
      - ./ib_builder.sh:/ib_builder.sh
    command: /bin/bash /ib_builder.sh

  builder-oldwrt:
    build:
      context: ..
      dockerfile: system/dockerfile.legacy
    environment:
      - CONF_FILE=${SELECTED_CONF}
      - HOST_OUTPUT_DIR=${HOST_OUTPUT_DIR}
    volumes:
      - imagebuilder-cache:/cache
      - ipk-cache:/builder_workspace/dl
      - ../${HOST_PKGS_DIR}:/input_packages
      - ../${HOST_FILES_DIR}:/overlay_files
      - ../firmware_output:/output
      - ../profiles:/profiles
      - ./openssl.cnf:/openssl.cnf
      - ./ib_builder.sh:/ib_builder.sh
    command: /bin/bash /ib_builder.sh

volumes:
  imagebuilder-cache:
  ipk-cache: